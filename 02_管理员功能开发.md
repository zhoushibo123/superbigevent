大事件项目-管理员功能



## 登陆

目标： 完成管理员登陆。

页面：web_back/login.html

### 基本实现

流程：

1. 登录按钮绑定点击事件。

   > 注意，这里不要让表单跳转页面了。

2. 判断用户名和密码是否为空
   1. 空：提示用户
   2. 非空：调用接口
      1. 响应回来之后根据提示
         1. 登录成功：去后台首页
         2. 登录失败：提示用户

```javascript
$('#btnLogin').click(function() {
    // 获取用户名和密码
    var myName = $('#myName').val().trim()
    var myPassword = $('#myPassword').val().trim()
    console.log(myName, myPassword);

    // 判断是否为空
    if(myName === '' || myPassword === ''){
        alert('不能为空');
        return; 
    }
    // 发请求，根据返回结果，提示用户
    // $.post(地址，参数，回调)
    $.post('http://localhost:8000/admin/login',{
        user_name: myName, 
        password:myPassword
    	}).then(res){
        console.log(res);
        if(res.code === 200){
            alert('登陆成功')
        } else {
            alert(res.msg)
        }
    }
  )
})
```



### 语义化处理

在login.html页面中，额外写一个对象user，其中有一个方法login，它就用实现登陆功能。

```javascript
var user = {
    login: function(myName, myPassword) {
        // 发请求，根据返回结果，提示用户
        // $.post(地址，参数，回调)
        return $.post('http://localhost:8000/admin/login',
               {
                user_name: myName, 
                password:myPassword
            }
    }
}
```

改造后代码如下：

```javascript
<script>
    $('#btnLogin').click(function() {
    // 获取用户名和密码
    var myName = $('#myName').val().trim()
    var myPassword = $('#myPassword').val().trim()
    // console.log(myName, myPassword);

    // 判断是否为空
    if(myName === '' || myPassword === ''){
        // alert('不能为空');
        return; 
    }

    // 语义化
    user.login(myName, myPassword).then(res){
                console.log(res);
                if(res.code === 200){
                    // window.alert('登陆成功')
                    location.href= './index.html'
                } else {
                    // alert(res.msg)
                }
            })
})
</script>
```



## 退出 

在index.html中

1. 首页中的登出按钮绑定点击事件。注意阻止a标签的默认跳转。

   `<a href="javascript:;" id="btnLogout"><i class="iconfont icon-tuichu"></i> 退出</a>`

2. 弹出对话框让用户确认

   与login.html中一样，进行语义化处置

```javascript
<script>
    var user = {
        logout: function () {
            // $.post(地址，参数，回调)
            return $.post('http://localhost:8000/admin/logout')

        }
    }
</script>
<script>
        $('#btnLogout').click(function() {
        // 弹窗让用户确认退出
        user.logout().then(function(res){
                if(res.code === 200){
                    // 退出, 回到登陆页
                    window.location.href = "./login.html"
                } 
            })
    })
</script>
```



## 模块化

现在 index.html,login.html中都有一个user对象，我们把它们合并一下，并统一放在一个文件中。

### 创建单独的模块

在js/utils/user.js中

```javascript
// 模块化式的开发 
// 把所有与用户相关的功能全写在一个对象中

// $.post(),$.get(),$.ajax() 得到都是一个对象
// 这个对象上有then方法，then()的功能是获取返回的数据
// $.post( ).then(function(res){  res 就是接口返回的数据 })

var user = {
    // 用户登陆
    login: function(name,password) {
        return $.post(APILIST.user_login,{
            'user_name': name,
            'password': password
        })
    },
    // 用户退出
    logout: function() {
        return $.post(APILIST.user_logout)
    }
}
```

APILIST是config.js中提供的。

### 提炼公共接口地址

js/uil/config.js

```javascript
// 配置文件
// 把这个项目中所有用到的接口地址全放在这里

// 所有接口的基地址
var BASEURL = 'http://192.168.172.82:8000'

// 用来保存所有的接口信息
var APILIST = {
    user_login: BASEURL + '/admin/login',
    user_logout: BASEURL + '/admin/logout',
}

```

### 引入模块

在index.html,和login.html中分别引入user.js，config.js文件。

index.html 中的退出功能

```javascript
<script src="./js/utils/config.js"></script>
<script src="./js/utils/user.js"></script>
<script>
    $('#btnLogout').click(function() {
    // $.post(地址，参数，回调)
    user.logout()
})
</script>
```

login.html中的登陆功能

```javascript
<script src="./js/utils/user.js"></script>
<script>
    // 1. 用户登陆
    // 思路：
    // 给按钮添加点击事件：
    // （1）收集用户信息，简单判断.
    //  (2) 请求ajax接口，根据接口的反馈做后续的动作
       $('#btnLogin').click(function(){
        var name =  $('#username').val().trim()
        var password = $('#password').val().trim()
        if(name.length === 0 || password.length === 0){
            alert('不能为空')
            return
        }

        // 用户登陆
        user.login(name, password).then(function(res){
            console.log(res)
            //2. 反馈做后续的动作
            if(res.code === 200){
                // alert('登陆成功')
                // 跳到主页
                window.location.href = "./index.html"
            } else {
                // 失败，直接打出错别信息
                alert(res.msg)
            }
        })

	})
})
</script>
```



## 用户信息-展示

实现 展示管理员信息的功能。

<img src="asset/1574256299168.png" alt="1574256299168" style="zoom:80%;" />

步骤：

1. 在user.js这个模块中添加一个方法用来获取信息
2. 在页面中调用这个方法，并显示数据



在user.js中添加一个方法`getInfo`用来获取管理员信息。

```javascript
// 模块化式的开发 
// 把所有与用户相关的功能全写在一个对象中

// $.post(),$.get(),$.ajax() 得到都是一个对象
// 这个对象上有then方法，then()的功能是获取返回的数据
// $.post( ).then(function(res){  res 就是接口返回的数据 })

var user = {
    // 用户登陆
    login: function(name,password) {
        return $.post(APILIST.user_login,{
            'user_name': name,
            'password': password
        })
    },
    // 用户退出
    logout: function() {
        return $.post(APILIST.user_logout)
    },
    // 获取信息
    getInfo:function(){
        return $.get(APILIST.user_getInfo)
    }
}
```

并在主页`index.html`中调用这个方法

```javascript
// 1. 用户退出
// 思路：
// 请求  退出接口
$('#btnLogout').click(function(){
    // 用户退出
    user.logout().then(function(res){
        console.log(res);
        if(res.code === 200){
            alert('成功退出')
            window.location.href = "./login.html"
        } else {
            alert(res.msg)
        }
    })
})

// 2. 获取管理员信息并显示
user.getInfo().then(function(res){
    console.log(res)
    if(res.code === 200){
        // 显示内容
        $('#userName').text( res.data.nickname )
        $('.userImg').attr('src',res.data.user_pic )
    }
})
```



## iframe标签

iframe 元素会创建包含另外一个文档的内联框架，它一般配合a标签的target属性一起使用。

它会创建一个“容器”，这个容器中可以引入另一个独立的.html文件。

```html
<body>
    <div class='container'>
        <a href="1.html" target="main">1</a>
        <a href="http://www.baidu.com" target="main_baidu">2</a>
    </div>
    <iframe src="1.html" name="main" frameborder="0" style="width:100%"></iframe>
    <iframe  name="main_baidu" frameborder="0" style="width:100%"></iframe>

</body>
```

注意：

- a标签的target值是iframe标签的name属性值
- iframe正常使用css设置样式



## 文章类别-显示

文章类别有四种操作：

- 查询
- 删除
- 修改
- 添加

在显示数据的过程中，可以采用模板引擎来渲染数据。

### 效果展示

文章类别是以表格的形式显示的。

<img src="asset/1574220215929.png" alt="1574220215929" style="zoom:67%;" />



表格的结构如下:

```html
<table class="table table-striped table-bordered table-hover mp20 category_table">
    <thead>
        <tr>
            <th>名称</th>
            <th>Slug</th>
            <th class="text-center" width="100">操作</th>
        </tr>
    </thead>
    <tbody id="tableContent">
        在这里填入数据
    </tbody>
    <tfoot>
        <tr>
            <td colspan="3" class="text-center">
                <a href="#" class="btn btn-success" data-toggle="modal" id="btnShowAddModal" data-target="#addModal">新增分类</a>
            </td>
        </tr>
    </tfoot>
</table>
```



### 基本思路

- 获取数据
  - 与用户模块一样，我们可以创建一个新的模块，并在其中封装一个对象来实现类别模块的各个功能。
- 显示数据
  - 把数据取出来之后，我们可以用前面学习的`模板字符串`来拼接，也可以采用额外的**模板引擎**技术。

### 封装模块以获取数据

在js/utils下添加一个category.js文件。内容如下：

```javascript
// 把所有与文章分类相关的操作写在这里

var category = {
    get:function(){
        return $.get(APILIST.category_get)
    }
}
```

### 在config.js中补充一个接口地址

```javascript
// 配置文件
// 把这个项目中所有用到的接口地址全放在这里

// 所有接口的基地址
var BASEURL = 'http://192.168.172.82:8000'

// 用来保存所有的接口信息
var APILIST = {
    user_login: BASEURL + '/admin/login',
    user_logout: BASEURL + '/admin/logout',
    user_getInfo: BASEURL + '/admin/getuser',

    // 获取文章分类
    category_get:  BASEURL + '/admin/category_search',
}
```



### 在页面中调用方法

article_category.html

```javascript
<script src="./js/util/config.js"></script>
<script src="./js/util/category.js"></script>
<script>
    // 1. 从接口中取出数据，显示在表格中
    category.get().then(function(res){
        console.log(res);
        // 渲染数据
    })
</script>
```



### 采用模板技术来生成页面

在 artcile_category.html中：

第一步：准备模板

```javascript
<script id="tmp_cate" type="text/html">
        {{each data item}}
            <tr>
                <td>{{item.name}}</td>
                <td>{{item.slug}}</td>
                <td class="text-center">
                    <a href="javascript:editTr({&quot;id&quot;:&quot;4&quot;,&quot;slug&quot;:&quot;travel&quot;,&quot;name&quot;:&quot;爱旅行&quot;});"
                        class="btn btn-info btn-xs">编辑</a>
                    <a href="javascript:deleteTr( 4 );" class="btn btn-danger btn-xs">删除</a>
                </td>
            </tr>
        {{/each}}
    </script>
```

注音：

​	提前引入js模板引擎文件。 `<script src="./js/lib/template-web.js"></script>` 如果找不到这个template-web.js就它的官网去下载一个。

第二步：获取数据并展示

js代码如下：

```javascript
// 从接口中取出数据，显示在表格中
category.get().then(function(res){
    // 用模板引擎渲染数据
    var htmlStr = template('tmp_cate', res)
    console.log(htmlStr);
    // 把html结构显示在tbody
    $('#category_table').html( htmlStr )
})
```



## 文章类别-删除

### 思路分析

<img src="asset/1574220215929-1579166403178.png" alt="1574220215929" style="zoom:67%;" />

由于数据是动态创建的，所以无法直接给按钮添加事件，可以采用**事件委托**的方式来处理。再考虑到`删除`功能在调用接口时需要传入id号，所以我们把当前分类的id号以自定义属性的方式附加在按钮上，以方便在事件响应函数中取出id来。



### 添加接口地址

config.js

```javascript
// 配置文件
// 把这个项目中所有用到的接口地址全放在这里

// 所有接口的基地址
var BASEURL = 'http://192.168.172.82:8000'

// 用来保存所有的接口信息
var APILIST = {
    user_login: BASEURL + '/admin/login',
    user_logout: BASEURL + '/admin/logout',
    user_getInfo: BASEURL + '/admin/getuser',

    // 获取文章分类
    category_get:  BASEURL + '/admin/category_search',
    // 添加文章分类
    category_add:  BASEURL + '/admin/category_add',
    // 删除文章分类
    category_del:  BASEURL + '/admin/category_delete',
    
}

```



### 在模块中添加方法

category.js添加del方法

```javascript
// 把所有与文章分类相关的操作写在这里

var category = {
    // 获取
    get:function(){
        return $.get(APILIST.category_get)
    },
    // 添加文章类型
    add:function(name,slug){
        return $.post(APILIST.category_add,{'name':name ,'slug':slug })
    },
    // 删除文章类型
    del:function(id){
        return $.post(APILIST.category_del,{'id': id})
    }
}
```

这个接口要参数id.



### 修改template

```html
<script type="text/html" id="table">
	{{each data item}}
        <tr>
              <td>{{item.name}}</td>
              <td>{{item.slug}}</td>
              <td class="text-center">
              <a href='javascript:editTr({"id":"{{item.id}}","slug":"{{item.slug}}","name":"{{item.name}}"});' class="btn btn-info btn-xs">编辑</a>
+              <a href="javascript:;" data-id="{{item.id}}" class="btn btn-danger btn-xs del">删除</a>
    </td>
    </tr>
      {{/each}}
</script>
```

要点：

- 阻止a标签的默认跳转`<a href="javascript:;"`；
- 给a标签添加特殊的类名`del`，以便事件委托。
- 给它加一个定自定义属性，用来传递要删除的id    data-id="{{item.id}}"

### 在父容器进行事件委托

代码如下：

```javascript
// 3. 删除

// 思路：用事件委托给 删除 添加点击事件
// (1) 获取id
// (2) 请求接口，根据反馈，做后续操作
$('#category_table').on('click', '.del',function(){
    // alert(1)
    // 在生成按钮时，要先设置自定义属性，再在这里获取自定义属性 data-id
    var id = $(this).attr('data-id')

    category.del(id).then(function(res){
        console.log(res);
        if(res.code === 200){
            // 删除成功,重新获取数据
            getAndShow()
        } else {
            alert(res.msg)
        }
    })
})
```





## 文章类别-添加

思路：

- 点击按钮，弹出模态框；

- 在模态框中填入信息，并提交接口；



### 添加接口地址

config.js

```javascript
// 配置文件
// 把这个项目中所有用到的接口地址全放在这里

// 所有接口的基地址
var BASEURL = 'http://192.168.172.82:8000'

// 用来保存所有的接口信息
var APILIST = {
    user_login: BASEURL + '/admin/login',
    user_logout: BASEURL + '/admin/logout',
    user_getInfo: BASEURL + '/admin/getuser',

    // 获取文章分类
    category_get:  BASEURL + '/admin/category_search',
    // 添加文章分类
+    category_add:  BASEURL + '/admin/category_add',
    
}

```



### 在模块中添加方法

·

```javascript
// 把所有与文章分类相关的操作写在这里

var category = {
    // 获取
    get:function(){
        return $.get(APILIST.category_get)
    },
    // 添加文章类型
    add:function(name,slug){
        return $.post(APILIST.category_add,{'name':name ,'slug':slug })
    }
}
```

add方法需要参数。



### 调用方法

给按钮添加点击事件。

```javascript
// 2. 添加功能
// 这里用到了bootstrap的模态框 https://v4.bootcss.com/docs/components/modal/
// 它会在页面上弹出一个对话框
// 点击添加按钮：
// (1) 收集用户信息, 简单判断
// (2) 发请求，根据反馈，做后续操作
$('#model_add').click(function(){
    var name = $('#name').val().trim()
    var slug = $('#slug').val().trim()

    if(name.length === 0 || slug.length === 0){
        alert('不能为空')
        return
    }

    console.log(name,slug);
    // 调用添加方法
    category.add(name,slug).then(function(res){
        console.log(res);
        if(res.code === 200){
            // 添成加功
            // (1) 清空用户的输入
            $('#name').val('')
            $('#slug').val('')
            // (2) 隐藏模态框
            $('#addModal').modal('hide'); // 把id为addModal的模态框隐藏起来
            // (3) 重新获取新数据
            getAndShow()
        } else {
            alert(res.msg)
        }
    })

})

// 关闭  隐藏模态框
$('#model_shutoff').click(function(){
    $('#addModal').modal('hide')
})
```







## 文章类别-编辑

思路：

- 先在模块中准备好编辑方法；
- 给父容器添加事件委托，以处理点击`编辑`事件
- 在点击编辑时：
  - 将必须的三个参数传给模态框；与删除文章类别一样，参数也可以通过自定义属性来传递；
  - 唤起模态框



### 添加接口地址

```javascript
// 配置文件
// 把这个项目中所有用到的接口地址全放在这里

// 所有接口的基地址
var BASEURL = 'http://192.168.172.82:8000'

// 用来保存所有的接口信息
var APILIST = {
    user_login: BASEURL + '/admin/login',
    user_logout: BASEURL + '/admin/logout',
    user_getInfo: BASEURL + '/admin/getuser',

    // 获取文章分类
    category_get:  BASEURL + '/admin/category_search',
    // 添加文章分类
    category_add:  BASEURL + '/admin/category_add',
    // 删除文章分类
    category_del:  BASEURL + '/admin/category_delete',
    // 编辑文章分类
+    category_edit:  BASEURL + '/admin/category_edit',
    
}

```



### 模块中添加方法

```javascript
var category = {
    // 获取
    get:function(){
        return $.get(APILIST.category_get)
    },
    // 添加文章类型
    add:function(name,slug){
        return $.post(APILIST.category_add,{'name':name ,'slug':slug })
    },
    // 删除文章类型
    del:function(id){
        return $.post(APILIST.category_del,{'id': id})
    },
    // 编辑文章类型
+    edit:function(id,name,slug){
        return $.post(APILIST.category_edit,{'id':id,'name':name ,'slug':slug })
    }
}
```

### 添加一个模态框



```html
<!-- 用来做编辑的模态框 -->
<div class="modal fade" id="editModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"></button>
                <h4 class="modal-title">编辑分类</h4>
            </div>
            <div class="modal-body">
                <form>
                    <!-- hidden的好处在于：1页面上不可见。 2.可以支持dom操作 -->
                    <input type="hidden"  class="form-control" id="edit_id">

                    <div class="form-group">
                        <label for="edit_name" class="control-label">分类名称:</label>
                        <input type="text" class="form-control" id="edit_name">
                    </div>
                    <div class="form-group">
                        <label for="edit_slug" class="control-label">分类别名:</label>
                        <input type="text" class="form-control" id="edit_slug">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" id="model_shutoff">关闭</button>
                <button type="button" class="btn btn-primary" id="model_save">保存</button>
            </div>
        </div>
    </div>
</div>


```



### 修改模板以传递参数

```html
<!-- {{each 数组 当前元素 当前下标}} -->
    <script id="tempTable" type="text/html">
        {{each data item}}
            <tr>
                <td>{{item.name}}</td>
                <td>{{item.slug}}</td>
                <td class="text-center">
+                    <a href="javascript:;" data-id="{{item.id}}"  data-name="{{item.name}}" data-slug="{{item.slug}}" class="btn btn-info btn-xs edit">编辑</a>
                    <a href="javascript:;" data-id="{{item.id}}" class="btn btn-danger btn-xs del">删除</a>
                </td>
            </tr>
        {{/each}}
    </script>
```

注意：

- 由于是修改，需要把id,name,slug都传过去
- .edit 类，方便做委托



### 父容器添加事件委托

```javascript
// 4. 编辑 
// 思路:
// 用事件委托给编辑按钮 添加点击事件
// （1）弹出模态框，并显示当前要编辑的内容
//  (2) 用户修改，点击保存，发请求，做后续操作
$('#category_table').on('click','.edit', function(){
    // 取出当前要编辑的内容
    var id = $(this).attr('data-id')
    var name = $(this).attr('data-name')
    var slug = $(this).attr('data-slug')
    // 弹出模态框
    //  给模态框中的input设置值
    $('#edit_id').val(id )
    $('#edit_name').val(name )
    $('#edit_slug').val(slug )
    $('#editModal').modal('show') // 弹出模态框
    // alert(1)
})
```



### 调用方法，保存编辑

```javascript
// 点击按钮 保存修改
        // (1) 收集用户信息, 简单判断
        // (2) 发请求，根据反馈，做后续操作
        $('#model_save').click(function(){
            var id =  $('#edit_id').val().trim()
            var new_name =  $('#edit_name').val().trim()
            var new_slug =  $('#edit_slug').val().trim()

            if(new_name.length === 0 || new_slug.length === 0){
                alert('不能为空')
                return
            }
            // console.log(id,new_name,new_slug);
            category.edit(id,new_name,new_slug).then(function(res){
                if(res.code === 200){
                    // 编辑成功
                    // (1) 隐藏模态框
                    $('#editModal').modal('hide'); // 把id为editModal的模态框隐藏起来
                    // (2) 重新获取新数据
                    getAndShow()
                } else {
                    alert(res.msg)
                }
                
            })
        })
```





## 文章-筛选功能-文章类别

![1574384287351](asset/1574384287351.png)



步骤：

- 获取数据
- 数据渲染

### 获取数据

引入js文件

````javascript
<script src="js/utils/config.js"></script>
<script src="js/utils/category.js"></script>
````



定义过show()方法，直接调用

```
// 查询所有文章类别信息，并显示
category.show(function(res){
        console.log(res);
            
            
        })
```



### 数据渲染

```
<script src="./js/template-web.js"></script>
    
```

定义内容

```javascript
<script id="cate_temp" type="text/html">
    <option>所有分类</option>
    {{each data item}}
    	<option>{{item.name}}</option>
    {{/each}}
</script>
```

渲染

```
// 查询所有文章类别信息，并显示
        category.show(function(res){
            // 使用模板引擎技术来渲染数据
            // var htmlStr = template(id,数据)
            var htmlStr = template("cate_temp", res)
            console.log(htmlStr);
            $('#selCategory').html(htmlStr)
            
        })
```



## 文章-基本显示

思路：

1. 观察html结构，准备写模板
2. 新增模块，并提供方法
   1. 建立 js/utils/article.js。把所有的与文章列表相关的操作全写在这个文件中
3. 在article_list.html入口函数中去发请求
   1. 用artttemplate渲染数据

![1574258105926](bigevent.assets/1574258105926.png)

### 添加接口地址

config.js

```javascript
// 配置文件
// 把这个项目中所有用到的接口地址全放在这里

// 所有接口的基地址
var BASEURL = 'http://192.168.172.82:8000'

// 用来保存所有的接口信息
var APILIST = {
    user_login: BASEURL + '/admin/login',
    user_logout: BASEURL + '/admin/logout',
    user_getInfo: BASEURL + '/admin/getuser',

    // 获取文章分类
    category_get:  BASEURL + '/admin/category_search',
    // 添加文章分类
    category_add:  BASEURL + '/admin/category_add',
    // 删除文章分类
    category_del:  BASEURL + '/admin/category_delete',
    // 编辑文章分类
    category_edit:  BASEURL + '/admin/category_edit',


    // 获取文章
+    article_get: BASEURL + '/admin/search'

}

```



### 创建模块，添加方法

新建文件：js/utils/article.js

```javascript
// 把所有与文章相关的操作写在这里

var article = {
    // 获取
    get:function(){
        return $.get(APILIST.article_get)
    }
}
```



### 调方法，取数据

article_list.html

```javascript
// 2. 获取文章列表，并显示在表格
        // 思路：
        // 调用接口，获取数据，用arttempaltte渲染到表格
        article.get().then(function(res){
            // console.log(res);
            if( res.code === 200){
                // arttempaltte渲染到表格
                var htmlStr = template('tmp_table', res)
                $('#tbody').html( htmlStr )
            } else {
                alert(res.msg)
            }
            
        })
```

### 模板引擎，显示数据

引入js文件

```
    <script src="./js/utils/config.js"></script>
    <script src="./js/utils/article.js"></script>
+   <script src="./js/template-web.js"></script>
```



写模板

```javascript
<!-- 文章列表 -->
    <script id="tmp_table" type="text/html">

        {{each data item}}
        <tr>
            <td>{{item.title}}</td>
            <td>{{item.author}}</td>
            <td>{{item.type}}</td>
            <td class="text-center">{{item.date}}</td>
            <td class="text-center">{{item.state}}</td>
            <td class="text-center">
                <a href="article_edit.html" class="btn btn-default btn-xs">编辑</a>
                <a href="javascript:deleteTr( 1005 );" class="btn btn-danger btn-xs">删除</a>
            </td>
        </tr>
        {{/each}}
    </script>
```



## 分页插件

http://josecebe.github.io/twbs-pagination/

它是基于jquery + bootstrap的分页插件。

### 基本使用

引入bootstrap的样式

引入jquery.js

引入插件的js

```html
<link rel="stylesheet" href="js/bootstrap/css/bootstrap.min.css">
</head>
<body>
    只需要放一个ul容器，插件本身会生成li
    <ul id="pagination-demo" class="pagination-sm"></ul>

    <script src="./js/jquery-1.12.4.min.js"></script>
    <script src="./js/jquery.twbsPagination.js"></script>
    <script>
        $('#pagination-demo').twbsPagination({
            totalPages: 46, // 总页数
            visiblePages: 6, // 可见页数
            first:'首页',
            prev:'上一页',
            next:'下一页',
            last:'尾页',
            onPageClick: function (event, page) {
                alert(page);
            }
        });
    </script>
</body>
```

效果如下：

![1574387017734](asset/1574387017734.png)

## 文章-分页

1. 先实现一个基本的分页；

![1574258091043](asset/1574258091043.png)

2. 在获取数据完成之后，去创建分页的功能。

   添加全局变量

   ```
   var curPage = 1; // 用来保存当前要查询的页数
   ```

   当点击分页插件上的页码时，就修改这个值
   
3. 把整个查询代码封装一下

   


```javascript
// 2. 获取文章列表，并显示在表格
// 思路：
// 调用接口，获取数据，用arttempaltte渲染到表格
function getAndShow() {
    article.get(curPage).then(function(res){
        // console.log(res);
        if( res.code === 200){
            // （1） arttempaltte渲染到表格
            var htmlStr = template('tmp_table', res)
            $('#tbody').html( htmlStr )

            // (2) 设置分页插件
            // 分页插件
            $('#pagination').twbsPagination({
                totalPages: res.totalPage, // 总页数
                visiblePages: 5,
                first:'首页',
                last:'尾页',
                prev:'上一页',
                next:'下一页',
                initiateStartPageClick:false, // 初始时，不要去点击起始页
                onPageClick: function (event, page) {
                    // 重新去取 第page页的数据
                    curPage = page
                    getAndShow();
                    // alert(page)
                }
            });

        } else {
            alert(res.msg)
        }

    })
}
```

article.js

```javascript
var article = {

    // 作用：获取第curPage的数据 
    show: function(curPage){
        // 根据接口的定义，要请哪一页的数据，就传对应的值给page
        return $.get(APIURLS.article_show,
            {
                page: curPage
            })
    }
}
```





## 文章-筛选

![1574259017270](asset/1574259017270.png)

思路：

- 全局变量保存参数
- 使用当前用户选择的文章的类型和状态去重新查询。不需要换接口，还是使用同样的接口。





### 定义全局变量

用来记录用户当前的选择

```javascript
// 全局变量 
var curPage = 1;    // 全局变量，表示当前要查询第几页的数据
var curType = '';   // 全局变量，表示当前要查询文章的类型编号
var curStatus = ''; // 全局变量，表示当前要查询文章的状态
```



### 筛选功能

修改一下模板

```
<!-- 文章类别 -->
    <script id="tmp_category" type="text/html">
        <option value="">所有分类</option>
        {{each data item}}
            <option value="{{item.id}}">{{item.name}}</option>
        {{/each}}
    </script>
```



- 更新变量的值
- 并以此为参数，重发请求

```javascript
// 3. 文章筛选 
// 思路：
// （1）获取用户当前的选择
//  (2) 调用接口，传入用户的选项
$('#btnSearch').click(function(){
    //    把页码重置为第一页
    curPage = 1
    // 把用户的选择保存到全局变量中
    curType = $('#selCategory').val() // 文章类型编号
    curStatus = $('#selStatus').val() // 文章状态
    // console.log(type,status);
    // 再去做查询并显示
    getAndShow();

})
```

修改getAndShow()

改参数

```javascript
// 2. 获取文章列表，并显示在表格
// 思路：
// 调用接口，获取数据，用arttempaltte渲染到表格
function getAndShow() {
    article.get(curPage,curType,curStatus).then(function(res){
        // console.log(res);
        if( res.code === 200){
            // （1） arttempaltte渲染到表格
            var htmlStr = template('tmp_table', res)
            $('#tbody').html( htmlStr )

            // 分页插件
            $('#pagination').twbsPagination({
                totalPages: res.totalPage, // 总页数
                visiblePages: 5,
                first:'首页',
                last:'尾页',
                prev:'上一页',
                next:'下一页',
                initiateStartPageClick:false, // 初始时，不要去点击起始页
                onPageClick: function (event, page) {
                    // 重新去取 第page页的数据
                    curPage = page
                    getAndShow();
                    // alert(page)
                }
            });

        } else {
            alert(res.msg)
        }

    })
}
```



### 修改article.js

给get方法补充参数

```javascript
var article = {
// 获取
    // page 就是当前要取出来的第几页的数据
    // type 就是当前文章的类型编号
    // status 就是当前文章的状态
    get:function(page,type,status){
        return $.get(APILIST.article_get,{'page': page,'type':type, 'state': status})
    },
}

```



## 解决筛选带来的总页数显示bug

现象：切换筛选条件之后，总页数虽然变化了，但是，分页插件上显示的总页数没有变。

原因：分页插件存在在一个问题，总页码变化时，必须要销毁重新再生成。[参考]( http://josecebe.github.io/twbs-pagination/ )

解决方案：

每次查询成功之后，都要检查本次请求与上次请求是否存在总页数的变化，如果有，则销毁重新再生成。



步骤：

添加一个全局变量，用来记录上一次查询的总页数

```javascript
var curPage = 1;    // 全局变量，表示当前要查询第几页的数据
var curType = '';   // 全局变量，表示当前要查询文章的类型编号
var curStatus = ''; // 全局变量，表示当前要查询文章的状态
var curTotalPage;   // 记录上一次获取的总页数
```

修改筛选功能

修改getAndShow

```javascript
function getAndShow() {
    article.get(curPage,curType,curStatus).then(function(res){
        // console.log(res);
        if( res.code === 200){
            // （1） arttempaltte渲染到表格
            var htmlStr = template('tmp_table', res)
            $('#tbody').html( htmlStr )

            // (2) 设置分页插件
            // 如果前后两次获取到总页码不一样，则要把分页插件：
            //   destroy()
            //   再来重新设置
            // 这样才能保存总页数显示正常
            if(curTotalPage !== res.totalPage){
                $('#pagination').twbsPagination('destroy')
                curTotalPage = res.totalPage
            }

            // 分页插件
            $('#pagination').twbsPagination({
                totalPages: res.totalPage, // 总页数
                visiblePages: 5,
                first:'首页',
                last:'尾页',
                prev:'上一页',
                next:'下一页',
                initiateStartPageClick:false, // 初始时，不要去点击起始页
                onPageClick: function (event, page) {
                    // 重新去取 第page页的数据
                    curPage = page
                    getAndShow();
                    // alert(page)
                }
            });

        } else {
            alert(res.msg)
        }
    })
}
```





## 文章-删除

使用 Ajax 请求完成删除文章

1. 添加事件委托，在点击事件中：
   1. 提示，确认删除。
   2. 获取id。通过自定义属性 `<a data-id="1">`
      1. 方式一：$(this).attr("data-id")
      2. 方式二：$(this).data("id")
   3. 调用article.js中的del 方法。
      1. 删除成功之后，重新获取

### 添加一个接口地址

config.js

```javascript
// 配置文件
// 把这个项目中所有用到的接口地址全放在这里

// 所有接口的基地址
var BASEURL = 'http://192.168.172.82:8000'

// 用来保存所有的接口信息
var APILIST = {
    user_login: BASEURL + '/admin/login',
    user_logout: BASEURL + '/admin/logout',
    user_getInfo: BASEURL + '/admin/getuser',

    // 获取文章分类
    category_get:  BASEURL + '/admin/category_search',
    // 添加文章分类
    category_add:  BASEURL + '/admin/category_add',
    // 删除文章分类
    category_del:  BASEURL + '/admin/category_delete',
    // 编辑文章分类
    category_edit:  BASEURL + '/admin/category_edit',


    // 获取文章
    article_get: BASEURL + '/admin/search',
    // 删除文章
+    article_del: BASEURL + '/admin/article_delete'
}

```



### 添加删除方法

article.js

```javascript
var article = {
    // 获取
    // page 就是当前要取出来的第几页的数据
    // type 就是当前文章的类型编号
    // status 就是当前文章的状态
    get:function(page,type,status){
        return $.get(APILIST.article_get,{'page': page,'type':type, 'state': status})
    },
    // 删除文章
+    del:function(id){
        return $.get(APILIST.article_del,{'id': id})
    }

}
```



### 在页面上，修改模板

```javascript
   <script id="table_temp" type="text/html">
        {{each data item}}
        <tr>
            <td>{{item.title}}</td>
            <td>{{item.author}}</td>
            <td>{{item.type}}</td>
            <td class="text-center">{{item.date}}</td>
            <td class="text-center">{{item.state}}</td>
            <td class="text-center">
                <a href="article_edit.html" class="btn btn-default btn-xs">编辑</a>
 +             <a href="javascript:;" data-id="{{item.id}}" class="btn btn-danger btn-xs del">删除</a>
            </td>
        </tr>
        {{/each}}
    </script>
```

添加自定义属性，保存id; 

让a标签不要跳转。`<a href="javascript:;" `



### 在页面上，添加事件委托

```javascript
// 4. 文章删除
// 思路：
// (1)给父容器加事件委托，实现删除按钮的点击
// (2)获取id，调用接口，根据反馈，做后续
$('#tbody').on('click','.del',function(){
    // 原则：让代码尽早结束
    if(!confirm('你确定要删除吗？')) {
        return 
    }

    var id = $(this).attr('data-id')
    // alert(id)
    article.del(id).then(function(res){
        console.log(res);
        if(res.code === 200){
            // 删除成功
            // 重新获取
            getAndShow()
        } else {
            alert(res.msg)
        }
    })
})
```



## 文章-添加

<img src="asset/1574495974344.png" alt="1574495974344" style="zoom:50%;" />

### 本地图片预览

目标：在提交之前，显示你所选择的文章封面。

思路：

​	在页面上放一个img标签。当用户通过文件域（input type ="file"）选择了某个图片时，这里会触发一个事件：change，把这个图片的地址设置成当前img标签的src，达到预览的效果。



要点：

- input type="file"文件域对象的files属性
- URL.createObjectUrl()方法

代码:

```html
<div class="form-group">
                    <label for="inputPassword3" class="col-sm-2 control-label">文章封面：</label>
                    <div class="col-sm-10">
                        <input name="cover" type="file" id="cover">
                    </div>
                    <img id="imgPreview" style="margin-left:20px;width: 200px;" src="../web_back/images/login_bg.jpg" alt="">
                </div>
```

补充一个用作预览功能的img.



```javascript
// 3. 图片预览
        $('#cover').change(function(){
            // 用户在input上进行了操作
            // this就是当前的dom元素
            // console.log(this);
            // console.log( this.files); //当前用户所有选中的文件放在这里这集合中
            // console.log( this.files[0]); //选中第一个文件
            
            // 1. 获取当前用户所选中的那个文件
            var curFile =  this.files[0]
            if(curFile) {
                console.log(curFile);
                // URL.createObjectURL(文件对象) 
                // 是一个浏览器提供的一个方法：用于创建对象的临时连接地址。
                // 结果是：blob:http://127.0.0.1:5500/b93736c3-9acb-451e-8c55-905a396c3dd6
                var curFileUrl = URL.createObjectURL(curFile)
                console.log(curFileUrl)
                // 2.把这个地址设置成imgPreview的src
                $('#imgPreview').attr('src', curFileUrl)
            } else {
                // 当前用户没有选中任何图片，还是使用初始图片
                $('#imgPreview').attr('src', '../web_back/images/login_bg.jpg')
            }
        })
```



### 显示文章 类别

在添加文章的过程中，我们先要显示出文章类型。基本的思路是：获取数据，再用模板引擎来渲染。

- 准备模板

- 引入模块文件

  

#### 准备模板

```javascript
<script id="tmp" type="text/html">
        {{each data item}}
            <option value="{{item.id}}">{{item.name}}</option>
        {{/each}}
    </script>
```

#### 引入文件

```javascript
<script src="./js/utils/config.js"></script>
<script src="./js/utils/category.js"></script>
<script src="./js/template-web.js"></script>
```

#### 调用方法

`category.show`方法在前面做类别管理时，是已经用过的，这里再次复用。

```javascript
// 显示文章类别
// 2.获取文章类别，并显示 
category.get().then(function(res){
    console.log(res);
    if(res.code == 200){
        var htmlStr = template('tmp',res)
        $('#selCategory').html( htmlStr )
    }else {
        alert(res.msg)
    }
})

```



### 对照接口去修改表单中的input

<img src="asset/1574495883839.png" alt="1574495883839" style="zoom:50%;" />

因为接口中需要传formData，而formData传参最重要的是使用表单组件中name属性。



```html
<form id="myform" class="form-horizontal article_form">
    <div class="form-group">
        <label for="inputEmail3" class="col-sm-2 control-label">文章标题：</label>
        <div class="col-sm-10">
            <input type="text" name="title" class="form-control" id="inputEmail3" placeholder="文章标题">
        </div>
    </div>
    <div class="form-group">
        <label for="inputPassword3" class="col-sm-2 control-label">文章封面：</label>
        <div class="col-sm-10">
            <input type="file" name="cover" id="exampleInputFile">
        </div>
    </div>
    <div class="form-group">
        <label for="inputEmail3" class="col-sm-2 control-label">文章类别：</label>
        <div class="col-sm-4">
            <select class="form-control" id="cate_container" name="type">

            </select>
        </div>
    </div>
    <div class="form-group">
        <label for="inputEmail3" class="col-sm-2 control-label">发布时间：</label>
        <div class="col-sm-4">

            <div class="input-group">
                <input type="text" class="form-control" placeholder="YYYY-MM-DD" name="date" id="dateinput">
                <span class="input-group-btn">
                    <button class="btn btn-default" type="button"
                            onclick="jeDate('#dateinput',{trigger:false,format: 'YYYY-MM-DD'})"><i
                                                                                                   class="iconfont icon-icondate"></i></button>
                </span>
            </div>
        </div>
    </div>
    <div class="form-group">
        <label for="inputEmail3" class="col-sm-2 control-label">文章内容：</label>
        <div class="col-sm-10">
            <textarea class="form-control" id="rich_content" name="content" placeholder="文章内容">
                Lorem ipsum dolor sit amet consectetur adipisicing elit. Assumenda fugiat illo nihil molestias ab. Laborum eius non atque, totam sapiente quae obcaecati assumenda ratione inventore pariatur maiores, qui libero delectus.
            </textarea>
            <!-- <textarea name="" id="" cols="30" rows="10"></textarea> -->
        </div>
    </div>
    <div class="form-group">
        <div class="col-sm-offset-2 col-sm-10">
            <button type="button" class="btn btn-success" id="btnAdd">发布</button>
            <button type="button" class="btn btn-default">存为草稿</button>
        </div>
    </div>
</form>
```

主要是修改name属性，要与接口中参数名一致。



### 给按钮添加点击事件

注意，这里需要传递FormData类型，在使用$.ajax时，要注意额外设置两个属性。

```javascript
// 1. 发布文章
        // 思路:
        // 给btnAdd添加点击事件
        // (1) 收集用户信息,简单判断
        //（2）调用接口，实现添加，根据反馈，做后续操作
        $('#btnAdd').click(function(){
            // alert(1)
            // 获取表单中用户填入的信息
            // 注意form中的表单元素必须要有name属性，并且要与接口中需要的参数保持一致
            var fd = new FormData (document.getElementById('myform'))
            
            // 手动补充一个参数
            fd.append('state', '已发布')

            // 获取富文本编辑器中的内容
            fd.set('content', tinyMCE.activeEditor.getContent())

            article.add(fd).then(function(res){
                console.log(res);
                
            })
        })
```

- fd.append() 补充一些参数
- fd.set() 更新参数的值
- fd.get() 获取参数的值

### 代码拆分

config.js中添加接口地址

```javascript
// 配置文件
// 把这个项目中所有用到的接口地址全放在这里

// 所有接口的基地址
var BASEURL = 'http://192.168.172.82:8000'

// 用来保存所有的接口信息
var APILIST = {
    user_login: BASEURL + '/admin/login',
    user_logout: BASEURL + '/admin/logout',
    user_getInfo: BASEURL + '/admin/getuser',

    // 获取文章分类
    category_get:  BASEURL + '/admin/category_search',
    // 添加文章分类
    category_add:  BASEURL + '/admin/category_add',
    // 删除文章分类
    category_del:  BASEURL + '/admin/category_delete',
    // 编辑文章分类
    category_edit:  BASEURL + '/admin/category_edit',


    // 获取文章
    article_get: BASEURL + '/admin/search',
    // 删除文章
    article_del: BASEURL + '/admin/article_delete',
    // 添加文章
 +   article_add: BASEURL + '/admin/article_publish'
}

```

article.js中添加方法



```javascript
// 把所有与文章相关的操作写在这里

var article = {
    // 获取
    // page 就是当前要取出来的第几页的数据
    // type 就是当前文章的类型编号
    // status 就是当前文章的状态
    get:function(page,type,status){
        return $.get(APILIST.article_get,{'page': page,'type':type, 'state': status})
    },
    // 删除文章
    del:function(id){
        return $.get(APILIST.article_del,{'id': id})
    },
+    add:function(fd){
        return $.ajax({
            url: APILIST.article_add,
            type: 'post',
            data: fd,
            processData:false, //不允许处理数据
            contentType:false, //不要设置请求头
        })
    }

}
```

在页面上，引入article.js，并调用方法 

```javascript
// 1. 发布文章
// 思路:
// 给btnAdd添加点击事件
// (1) 收集用户信息,简单判断
//（2）调用接口，实现添加，根据反馈，做后续操作
$('#btnAdd').click(function(){
    // alert(1)
    // 获取表单中用户填入的信息
    // 注意form中的表单元素必须要有name属性，并且要与接口中需要的参数保持一致
    var fd = new FormData (document.getElementById('myform'))

    // 手动补充一个参数
    fd.append('state', '已发布')

    // 获取富文本编辑器中的内容
    fd.set('content', tinyMCE.activeEditor.getContent())

    article.add(fd).then(function(res){
        console.log(res);

    })
})
```



## 文章-编辑

思路：

- 在article_list.html中对 `编辑按钮`添加跳转动作，以进入到编辑文章（article_eidt.html）的页面，要传入准备编辑的文章的编号。
- 在编辑文章页面中
  - 先根据文章的编号获取并**显示**当前要编辑的文章信息
  - 用户修改......
  - 调用接口，以保存用户编辑后的信息

### 修改article_list.html中的模板

在article_list.html中给编辑按钮添加页面跳转，并传递id。

![1574506458928](asset/1574506458928.png)

对应的改动如下：

```javascript
<script id="tmp" type="text/html">
    {{each data item }}
        <tr>
            <td>{{item.title}}</td>
            <td>{{item.author}}</td>
            <td>{{item.type}}</td>
            <td class="text-center">{{item.date}}</td>
            <td class="text-center">{{item.state}}</td>
            <td class="text-center">
+        <a href="./article_edit.html?id={{item.id}}" class="btn btn-default btn-xs">编辑</a>
    	<a data-id="{{item.id}}" href="javascript:;" class="btn btn-danger btn-xs del">删除</a>
    		</td>
    	</tr>
    {{/each}}
  </script>
```



### 从地址栏中拆出id来

article_eidt.html中

```javascript
// 1. 从地址栏中获取当前要编辑的文章的编号
// http://127.0.0.1:5500/web_back/article_edit.html?id=1574556041361  ====> 1574556041361
// (1) window.location.search ====> ?id=1574556041361
// (2) 通过substr(起点下标，长度）。如果不写第二个参数substr就会截取从起点开始到最后的全部内容
var str = window.location.search

var id = str.substr(4);// 跳过  ?id= 这四个字符
```



### 先获取文章详情内容并显示

- config.js中检查接口地址

- article.js中补充一个方法
- 在article_eidt.html中获取并显示

```javascript
// 配置文件
// 把这个项目中所有用到的接口地址全放在这里

// 所有接口的基地址
// 就是运行小黑窗服务器的地址.如果当前的服务器就是在自已电脑上，就可以直接写成localhost
// var BASEURL = 'http://localhost:8000'
// var BASEURL = 'http://192.168.0.108:8000'
var BASEURL = 'http://39.99.130.177:8000'

// 用来保存所有的接口信息
var APILIST = {
    // ...
    // 获取文章
+    article_get: BASEURL + '/admin/search',

}
```



```javascript
var article = {
+   /**
     * 根据id去获取文章的详情
     * @param {Number}} id 
     */
    getById:function(id){
        return $.get(APILIST.article_get,{'id':id})
    },
}
```

调用这个方法，显示内容

```javascript
   <script src="./js/util/config.js"></script>
    <script src="./js/util/article.js"></script>


var id = window.location.search.substr(4)
        // 接下来要调用接口去取信息
        article.getById(id).then(function(res){
            console.log(res);
            if(res.code === 200){
                // 把结果显示在页面上：把数据填入到表单中
                $('#title').val( res.data.title )
                $('#previewImg').attr('src', res.data.cover )
                $('#dateinput').val(res.data.date)
                
                // 给富文件编辑器，设置内容
                setTimeout (function(){
                    // tinymce.activeEditor.setContent能生效的前提是
                    // 富文本编辑器已经就绪了。如果说ajax数据回来了，但是富文本编辑器还没有绪
                    // 它就可以会报错，所以给它加一点延迟。
                    tinymce.activeEditor.setContent( res.data.content )
                },1000)

            } else {
                alert(res.msg)
            }
            
        })
```





### 当前文章类型处于选中状态

![image-20200205113705938](asset/image-20200205113705938.png)

思路：

- 获取全部的类型，并显示在下拉列表中（可以使用模板引擎技术）
- 当前文章的信息取回来之后，把当前文章类型处于**选中状态**



步骤：

在article_edit.html中，先调用category.js中的get方法，以获取所有的类别，

再来发请求获取文章详情，详情回来之后，通过`$('#type').val(文章类型编号)`来显示当前的文章的类型。



代码:

```javascript
// 实现文章编辑
//  （1） 先发ajax求类别 （2）完成之后，再发ajax求详情
// 1. 获取当前要编辑的文章id
// window.location:是一个bom对象，保存浏览器当前页面的url信息，它是一个对象
//      http://127.0.0.1:5500/web_back/article_edit.html?id=1580870111528
// window.location.search：获取当前页面的url信息中查询字符串的值
//      ?id=1580870111528
console.log(window.location);
console.log(window.location.search); // ?id=1580870111528
// str.substr(起始下标，取出多长) 如果省略第二个参数就是取出从起点开始到结束的全部

// 2. 根据id去取回这篇文章的信息，并显示在页面上
var id = window.location.search.substr(4)


getAndShowCategory()
// 3. 实现保存编辑
// 接下来要调用接口去取信息
function getAndShow(id) {
    article.getById(id).then(function(res){
        console.log(res);
        if(res.code === 200){
            // 把结果显示在页面上：把数据填入到表单中
            $('#title').val( res.data.title )
            $('#previewImg').attr('src', res.data.cover )
            $('#dateinput').val(res.data.date)

            $('#type').val(res.data.type)

            // 给富文件编辑器，设置内容
            setTimeout (function(){
                // tinymce.activeEditor.setContent能生效的前提是
                // 富文本编辑器已经就绪了。如果说ajax数据回来了，但是富文本编辑器还没有绪
                // 它就可以会报错，所以给它加一点延迟。
                tinymce.activeEditor.setContent( res.data.content )
            },1000)
        } else {
            alert(res.msg)
        } 
    })
}

function getAndShowCategory(){
    category.get().then(function(res){
        console.log(res);
        if(res.code ===200){
            var htmlStr = template('cate',res)
            console.log(htmlStr);
            // 写入select
            $('#type').html( htmlStr )
            // 让一个下拉框选中指定的文章的类型
            // $('#type').val(1580867650235)

            // 类别获取完成之后，再去获取并显示文章详情
            getAndShow(id)
        }else{
            alert(res.msg)
        }

    })
}
```



### 再设置保存功能

思路：

- 给按钮添加点击事件
  - 收集数据
  - 调用接口
  - 根据接口反馈做后续动作

先在config.js中添加一个接口地址

```javascript
// 接口的基地址
var baseUrl = 'http://localhost:8000/'

// 把所有要用到的接口地址进行集中管理
var APIURLS = {
+   article_edit: baseUrl + 'admin/article_edit'
}
```



在aritcle.js中添加一个方法

```javascript
var article = {
     // 其它
    // fd: formData对象
+    edit: function(fd) {
       return $.ajax({
            type:'post',
            url : APIURLS.article_edit,
            data: fd,
            processData:false, // 不要让jquery去处理formData数据
            contentType:false, // 不设置默认的请求头
            
        })
    }
}
```

在页面上调用这个方法

要提前去修改表单中的：

- 去掉按钮上的跳转动作
- 修改input框的name属性与接口中的参数保持一致

```javascript
// 3. 保存修改
$('#btnSave').click(function(){
    // var fd = new FormData(form对象)
    var fd = new FormData(document.getElementById('myform'))
    fd.append("id", id )
    // set 就是更新 键值对
    fd.set('content', tinyMCE.activeEditor.getContent())
    // 新添加的
    article.edit(fd).then(function(res){
        if(res.code === 200){
            alert('修改成功')
        } else {
            alert(res.msg)
        } 
    })
})
```









